<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Jerome Boyer"><link href=../ rel=prev><link href=../eepm/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.6"><title>Event Streams schema - EDA technical academy</title><link rel=stylesheet href=../../assets/stylesheets/main.558e4712.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#producing-consuming-data-with-event-streams-and-schema class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="EDA technical academy" class="md-header__button md-logo" aria-label="EDA technical academy" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> EDA technical academy </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Event Streams schema </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ibm-cloud-architecture/eda-tech-academy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Introduction </a> </li> <li class=md-tabs__item> <a href=../../eda/ class=md-tabs__link> Information </a> </li> <li class=md-tabs__item> <a href=../ class="md-tabs__link md-tabs__link--active"> Journey 1 </a> </li> <li class=md-tabs__item> <a href=../../lab1/ class=md-tabs__link> Journey 2 </a> </li> <li class=md-tabs__item> <a href=../../future/ class=md-tabs__link> More... </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="EDA technical academy" class="md-nav__button md-logo" aria-label="EDA technical academy" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> EDA technical academy </label> <div class=md-nav__source> <a href=https://github.com/ibm-cloud-architecture/eda-tech-academy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 tabindex=0 aria-expanded=false> Information <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Information data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Information </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../eda/ class=md-nav__link> Why EDA now? </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/refarch-eda/concepts/fit-to-purpose/ class=md-nav__link> Fit for purpose </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/refarch-eda/introduction/reference-architecture/#event-driven-architecture class=md-nav__link> EDA Reference Architecture </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 tabindex=0 aria-expanded=true> Journey 1 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Journey 1" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Journey 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> Getting started with Event Streams </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Event Streams schema <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Event Streams schema </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=#lab-objective class=md-nav__link> Lab Objective </a> </li> <li class=md-nav__item> <a href=#setting-up-the-client-machine class=md-nav__link> Setting Up The Client Machine </a> </li> <li class=md-nav__item> <a href=#pre-requisites class=md-nav__link> Pre-Requisites </a> </li> <li class=md-nav__item> <a href=#understanding-schema-registry class=md-nav__link> Understanding Schema Registry </a> <nav class=md-nav aria-label="Understanding Schema Registry"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-is-a-schema-registry class=md-nav__link> What is a Schema Registry? </a> </li> <li class=md-nav__item> <a href=#how-the-schema-registry-works class=md-nav__link> How the Schema Registry Works? </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lab-procedures class=md-nav__link> Lab Procedures </a> <nav class=md-nav aria-label="Lab Procedures"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-a-topic-and-attaching-a-schema-to-it class=md-nav__link> Creating a topic and attaching a schema to it </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#creating-a-kafka-user-with-appropriate-rights class=md-nav__link> Creating a Kafka User with appropriate rights. </a> </li> <li class=md-nav__item> <a href=#gather-connection-details class=md-nav__link> Gather Connection Details </a> </li> <li class=md-nav__item> <a href=#test-producer-consumer class=md-nav__link> Test Producer / Consumer </a> </li> <li class=md-nav__item> <a href=#check-the-impact-of-changing-the-schema-registry class=md-nav__link> Check the impact of changing the Schema Registry </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../eepm/ class=md-nav__link> Event-endpoint management </a> </li> <li class=md-nav__item> <a href=../mm2/ class=md-nav__link> Mirror maker 2 lab </a> </li> <li class=md-nav__item> <a href=../../demo/ class=md-nav__link> Demonstration A to Z </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 tabindex=0 aria-expanded=false> Journey 2 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Journey 2" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Journey 2 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4_1 type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 tabindex=0 aria-expanded=false> Lab 1 - System Design Lab <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Lab 1 - System Design Lab" data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Lab 1 - System Design Lab </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../lab1/ class=md-nav__link> Problem Statement </a> </li> <li class=md-nav__item> <a href=../../lab1/lab1-sol/ class=md-nav__link> Solution Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 tabindex=0 aria-expanded=false> Kafka Streams Lab <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kafka Streams Lab" data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Kafka Streams Lab </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../lab2/kstream/ class=md-nav__link> Kafka Streams Study </a> </li> <li class=md-nav__item> <a href=../../lab2/ class=md-nav__link> Lab 2 exercises </a> </li> <li class=md-nav__item> <a href=../../lab2/lab2-sol/ class=md-nav__link> Solution Overview </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../lab3/ class=md-nav__link> Lab 3 - Real Time Inventory demo </a> </li> <li class=md-nav__item> <a href=../../lab4/ class=md-nav__link> Lab 4 - EDA GitOps </a> </li> <li class=md-nav__item> <a href=../../lab5/ class=md-nav__link> Lab 5 - Monitoring with Instana </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../future/ class=md-nav__link> More... </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=#lab-objective class=md-nav__link> Lab Objective </a> </li> <li class=md-nav__item> <a href=#setting-up-the-client-machine class=md-nav__link> Setting Up The Client Machine </a> </li> <li class=md-nav__item> <a href=#pre-requisites class=md-nav__link> Pre-Requisites </a> </li> <li class=md-nav__item> <a href=#understanding-schema-registry class=md-nav__link> Understanding Schema Registry </a> <nav class=md-nav aria-label="Understanding Schema Registry"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-is-a-schema-registry class=md-nav__link> What is a Schema Registry? </a> </li> <li class=md-nav__item> <a href=#how-the-schema-registry-works class=md-nav__link> How the Schema Registry Works? </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lab-procedures class=md-nav__link> Lab Procedures </a> <nav class=md-nav aria-label="Lab Procedures"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-a-topic-and-attaching-a-schema-to-it class=md-nav__link> Creating a topic and attaching a schema to it </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#creating-a-kafka-user-with-appropriate-rights class=md-nav__link> Creating a Kafka User with appropriate rights. </a> </li> <li class=md-nav__item> <a href=#gather-connection-details class=md-nav__link> Gather Connection Details </a> </li> <li class=md-nav__item> <a href=#test-producer-consumer class=md-nav__link> Test Producer / Consumer </a> </li> <li class=md-nav__item> <a href=#check-the-impact-of-changing-the-schema-registry class=md-nav__link> Check the impact of changing the Schema Registry </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=producing-consuming-data-with-event-streams-and-schema>Producing &amp; Consuming Data with Event Streams and Schema<a class=headerlink href=#producing-consuming-data-with-event-streams-and-schema title="Permanent link">&para;</a></h1> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">&para;</a></h2> <p>Version control can be a nightmare for organizations. With Kafka, it’s no different. With stream processing pipelines, there are no files to act as containers for messages with a single format. Let take a look at how Event Streams handles Schema Management with the Schema Registry.</p> <h2 id=lab-objective>Lab Objective<a class=headerlink href=#lab-objective title="Permanent link">&para;</a></h2> <p>In this lab, we’ll do the following: </p> <ul> <li>Create a topic and attach a schema to it</li> <li>Create a Kafka User with appropriate rights to produce and consume data</li> <li>Gather information needed to connect to the Kafka cluster and Schema registry.</li> <li>Test producing / consuming data.</li> <li>Make changes to the Schema and see the impact to producer/consumer.</li> </ul> <p>The following figure illustrates the components involved in this lab:</p> <p><img alt src=../images/es-schema-lab.png width=1200></p> <p>You will run producer and consumer apps on your laptop, and they will contact schema registry and brokers using SCRAM authentication and TLS encryption.</p> <h2 id=setting-up-the-client-machine>Setting Up The Client Machine<a class=headerlink href=#setting-up-the-client-machine title="Permanent link">&para;</a></h2> <p>Setting up the sample Kafka Client to be used for the lab.</p> <p>This section provides the instructions for setting up the Kafka Client that will be used throughout the labs.</p> <ol> <li> <p>Check java install</p> <p><img alt src=../images/lab-2-set-1.png></p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>C:<span class=se>\U</span>sers<span class=se>\r</span>ajan&gt;java<span class=w> </span>-version
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>At<span class=w> </span>least<span class=w> </span>version<span class=w> </span><span class=m>17</span>.0<span class=w> </span>should<span class=w> </span>be<span class=w> </span>available.
</code></pre></div> <p>If it’s not installed, download and install the Java Runtime. Use the <a href=https://adoptium.net/ >adoptium site to download Java</a></p> </li> <li> <p>Download the sample Kafka Client code <a href=https://github.com/natarajan-k/kafka-client/raw/main/pre-compiled/KafkaClient_20240203.zip>from here:</a> to be used on your local laptop.</p> </li> <li> <p>Unzip the downloaded Kafka Client (KafkaClient_YYYYMMDD.zip) into a folder: </p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>C:<span class=se>\T</span>echJam<span class=se>\E</span>ventStreams_Lab<span class=se>\</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>unzip<span class=w> </span>KafkaClient_20240203.zip<span class=w> </span>
</code></pre></div> </li> <li> <p>Test the client: Open a Command Prompt.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nb>cd</span><span class=w> </span>C:<span class=se>\T</span>echJam<span class=se>\E</span>ventStreams_Lab<span class=se>\K</span>afkaClient_YYYYMMDD<span class=se>\</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>java<span class=w> </span>-jar<span class=w> </span>KafkaClient.jar
</code></pre></div> </li> </ol> <p><img alt src=../images/lab-2-set-2.png width=1200></p> <h2 id=pre-requisites>Pre-Requisites<a class=headerlink href=#pre-requisites title="Permanent link">&para;</a></h2> <ul> <li>Have setup the client machine properly. </li> <li>Able to access the Event Streams web interface. </li> </ul> <h2 id=understanding-schema-registry>Understanding Schema Registry<a class=headerlink href=#understanding-schema-registry title="Permanent link">&para;</a></h2> <h3 id=what-is-a-schema-registry>What is a Schema Registry?<a class=headerlink href=#what-is-a-schema-registry title="Permanent link">&para;</a></h3> <p>Schema Registry provides a serving layer for your metadata. It provides a RESTful interface for storing and retrieving your Avro®, JSON Schema, and Protobuf schemas. </p> <ul> <li>It stores a versioned history of all schemas based on a specified subject name strategy, provides multiple compatibility settings.</li> <li>Allows evolution of schemas according to the configured compatibility settings and expanded support for these schema types. </li> <li>Provides serializers that plug into Apache Kafka® clients that handle schema storage and retrieval for Kafka messages that are sent in any of the supported formats.</li> </ul> <p>In Event Streams, Schemas are stored in internal Kafka topics by the <a href=http://apicur.io/registry>Apicur.io Registry</a>, an open-source schema registry led by Red Hat. In addition to storing a versioned history of schemas, Apicurio Registry provides an interface for retrieving them. Each Event Streams cluster has its own instance of Apicurio Registry providing schema registry functionality.</p> <p><img alt src=../diagrams/lab-2-sc-1.drawio.svg width=1200></p> <h3 id=how-the-schema-registry-works>How the Schema Registry Works?<a class=headerlink href=#how-the-schema-registry-works title="Permanent link">&para;</a></h3> <p>Now, let’s take a look at how the Schema Registry works.</p> <ol> <li>Sending applications request schema from the Schema Registry.</li> <li>The scheme is used to automatically validates and serializes be for the data is sent.</li> <li>Data is sent, serializing makes transmission more efficient. </li> <li>The receiving application receives the serialized data.</li> <li>Receiving application request the schema from the Schema Registry. </li> <li>Receiving application deserializes the same data automatically as it receives the message. </li> </ol> <p><img alt src=../images/lab-2-sc-2.png></p> <h2 id=lab-procedures>Lab Procedures<a class=headerlink href=#lab-procedures title="Permanent link">&para;</a></h2> <h3 id=creating-a-topic-and-attaching-a-schema-to-it>Creating a topic and attaching a schema to it<a class=headerlink href=#creating-a-topic-and-attaching-a-schema-to-it title="Permanent link">&para;</a></h3> <ol> <li> <p>Click on one of the links below (depending on the OpenShift cluster allocated to you) to log into your Event Streams instance using the student credentials provided. Once you've logged in, you'll see the Event Streams homepage.</p> <table> <thead> <tr> <th>Host</th> <th>URL</th> </tr> </thead> <tbody> <tr> <td>Finn</td> <td><a href=https://cpd-cp4i.apps.finn.coc-ibm.com/integration/kafka-clusters/cp4i-eventstreams/es-demo/gettingstarted>https://cpd-cp4i.apps.finn.coc-ibm.com/integration/kafka-clusters/cp4i-eventstreams/es-demo/gettingstarted</a></td> </tr> <tr> <td>Cody</td> <td><a href=https://cpd-cp4i.apps.cody.coc-ibm.com/integration/kafka-clusters/cp4i-eventstreams/es-demo/gettingstarted>https://cpd-cp4i.apps.cody.coc-ibm.com/integration/kafka-clusters/cp4i-eventstreams/es-demo/gettingstarted</a></td> </tr> <tr> <td>Ventress</td> <td><a href=https://cpd-cp4i.apps.ventress.coc-ibm.com/integration/kafka-clusters/cp4i-eventstreams/es-demo/gettingstarted>https://cpd-cp4i.apps.ventress.coc-ibm.com/integration/kafka-clusters/cp4i-eventstreams/es-demo/gettingstarted</a></td> </tr> </tbody> </table> <p><img alt src=../images/lab-1-es-1.png></p> </li> <li> <p>Create Topic.</p> <p>Click on Create a Topic. Use only lower cases for the topic name (e.g. <code>finn20-customers</code>).</p> <p><img alt src=../images/lab-2-sc-3.png width=900></p> <p>Please refer to screenshots attached as sample. </p> <p><img alt src=../images/lab-2-sc-4.png width=1200></p> </li> <li> <p>Next create the schema and attach to the topic. </p> <ul> <li>Click on the Schema Registry tab in the left. </li> </ul> <p><img alt src=../images/lab-2-sc-6.png width=600></p> <ul> <li>Click on Add Schema (in the right)</li> </ul> </li> </ol> <p><img alt src=../images/lab-2-sc-5.png width=600></p> <ul> <li> <p>Click Upload Definition -&gt; Choose <code>customer.avsc</code> located in the Kafka Client unzipped folder. (<code>C:\TechJam\EventStreams_Lab\KafkaClient_YYYYMMDD\</code>)</p> <p><img alt src=../images/lab-2-sc-7.png width=1200></p> <ul> <li>Check the details and make sure the schema is valid. </li> <li><strong>Change the name of the schema</strong> to avoid conflict with other students: The name of the schema maps the schema to the topic. To attach this schema to your topic, the schema should be named according to the topic: <topic_name>-value. (For example, if your topic is <code>finn20-customers</code>”, the schema should be named)</li> </ul> <p><img alt src=../images/lab-2-sc-8.png width=1200></p> <p>Click on Add Schema. The schema is now attached to the topic. </p> </li> </ul> <h2 id=creating-a-kafka-user-with-appropriate-rights>Creating a Kafka User with appropriate rights.<a class=headerlink href=#creating-a-kafka-user-with-appropriate-rights title="Permanent link">&para;</a></h2> <ol> <li> <p>Go to the Event Streams home page. <strong>Select</strong> “Connect to this Cluster” -&gt; Generate SCRAM Credentials.</p> <p><img alt src=../images/lab-2-sc-9.png width=1200></p> </li> </ol> <p><img alt src=../images/lab-2-sc-10.png></p> <div class=highlight><pre><span></span><code>Refer to the screenshot attached as reference.
</code></pre></div> <p><img alt src=../images/lab-2-sc-11.png width=1300></p> <div class=highlight><pre><span></span><code>Keep information about the SCRAM password.
</code></pre></div> <h2 id=gather-connection-details>Gather Connection Details<a class=headerlink href=#gather-connection-details title="Permanent link">&para;</a></h2> <p>Creating connection from Consumer / Producer requires some connectivity details. These details can be gathered from the Event Stream’s portal. Connectivity details needed will depend on type of authentication and SASL mechanism used. </p> <p>From the Event Stream home page, click on “Connect to this Cluster”. Get the following information from the page. Refer to screenshot below on how to get these.</p> <ol> <li>Bootstrap URL</li> <li>Truststore Certificate File. Copy the downloaded file to the Kafka Client folder.</li> <li>Truststore Password. (Password will be generated once Download Certificate is clicked).</li> <li>Schema Registry URL</li> </ol> <p><img alt src=../images/lab-2-sc-12.png width=1200></p> <h2 id=test-producer-consumer>Test Producer / Consumer<a class=headerlink href=#test-producer-consumer title="Permanent link">&para;</a></h2> <ol> <li> <p>Prepare the <code>config.properties</code> file located in <code>C:\TechJam\EventStreams_Lab\KafkaClient_YYYYMMDD\</code> Check and change the following fields. The fields not mentioned here can be left default. </p> <table> <thead> <tr> <th>Field</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>enableschemaavro</td> <td>True (as we have schema attached to the topic)</td> </tr> <tr> <td>bootstrap.servers</td> <td>Enter the URL obtained in previous section e.g. es1-kafka-bootstrap-cp4i.apps.ocp46.tec.uk.ibm.com:443</td> </tr> <tr> <td>sasl.jaas.config</td> <td>Paste this string. Replace the Username and Password. org.apache.kafka.common.security.scram.ScramLoginModule required username='<scram_user>' password='<scram_password>';</td> </tr> <tr> <td>sasl.mechanism</td> <td>SCRAM-SHA-512</td> </tr> <tr> <td>security.protocol</td> <td>SASL_SSL</td> </tr> <tr> <td>topic</td> <td>Topic created previously. E.g. jam60-topic1</td> </tr> <tr> <td>group.id</td> <td>Enter a Consumer Group ID. You can enter a Consumer Group. Remember that it should have a prefix of your studentID. E.g. jam60-consumer-group-v1</td> </tr> <tr> <td>ssl.truststore.location</td> <td>Should point to the Truststore certificate downloaded. Example: ./es-cert.p12</td> </tr> <tr> <td>ssl.truststore.password</td> <td>Enter the Truststore password obtained.</td> </tr> <tr> <td>apicurio.registry.url</td> <td>Enter the URL obtained in previous section e.g. https://es1-ibm-es-ac-reg-external-cp4i.apps.ocp46.tec.uk.ibm.com</td> </tr> <tr> <td>schema.registry.basic.auth.user</td> <td>\&lt;SCRAM_USER></td> </tr> <tr> <td>schema.registry.basic.auth.password</td> <td>\&lt;SCRAM_PASSWORD></td> </tr> <tr> <td>schema.registry.ssl.truststore.location</td> <td>Same as ssl.truststore.location</td> </tr> <tr> <td>schema.registry.ssl.truststore.password</td> <td>Same as ssl.truststore.password</td> </tr> </tbody> </table> <p>This is how your <code>config.properties</code> should look like after the changes. This is a sample. Do not copy and paste this contents. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1>## Mandatory Section ##</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=c1># Set to true if avro schema is enabled for the topic</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=nv>enableschemaavro</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=c1># Set to true if want to enable Intercept Monitoring.</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=nv>enableintercept</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=c1># Set this to true if mTLS (2-way TLS authentication) is enabled.</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=nv>enablemtls</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=c1># Broker related properties</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>bootstrap.servers<span class=w> </span><span class=o>=</span><span class=w> </span>es-demo-kafka-bootstrap-cp4i-eventstreams.apps.cody.coc-ibm.com:443
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>sasl.jaas.config<span class=w> </span><span class=o>=</span><span class=w> </span>org.apache.kafka.common.security.scram.ScramLoginModule<span class=w> </span>required<span class=w> </span><span class=nv>username</span><span class=o>=</span><span class=s1>&#39;cody200-sr-user&#39;</span><span class=w> </span><span class=nv>password</span><span class=o>=</span><span class=s1>&#39;EelwRR1&#39;</span><span class=p>;</span>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=c1># Example: sasl.jaas.config = org.apache.kafka.common.security.scram.ScramLoginModule required username=&#39;student01&#39; password=&#39;B9BmjHvJZC&#39;;</span>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=c1># Options are PLAIN, SCRAM-SHA-512, GSSAPI</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>sasl.mechanism<span class=o>=</span>SCRAM-SHA-512
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=c1># Options are SSL, PLAINTEXT, SASL_SSL, SASL_PLAINTEXT</span>
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>security.protocol<span class=o>=</span>SASL_SSL
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=nv>topic</span><span class=o>=</span>cody200-sr
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=c1># Consumer Group ID</span>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>group.id<span class=w> </span><span class=o>=</span><span class=w> </span>cody200-group1
<a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=c1># Example: group.id = student01-group</span>
<a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>client.id<span class=o>=</span>302071b2-7daf-4844
<a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=c1>#--------------------------------</span>
<a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a><span class=c1>## To be filled in if TLS is enabled for the Brokers</span>
<a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a><span class=c1># Options are PKCS12, JKS, PEM. Password not required for PEM.</span>
<a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>ssl.truststore.type<span class=o>=</span>PKCS12
<a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a>ssl.truststore.location<span class=o>=</span>./es-cert.p12
<a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a>ssl.truststore.password<span class=o>=</span>luONbNsf
<a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a><span class=c1>#--------------------------------</span>
<a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a><span class=c1>## To be filled if mTLS (Mutual TLS) is enabled in Brokers</span>
<a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a>ssl.keystore.location<span class=o>=</span>/home/rajan/load_security/kafka.client.keystore.jks
<a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a>ssl.keystore.password<span class=o>=</span>clientpass
<a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a>ssl.key.password<span class=o>=</span>clientpass
<a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a><span class=c1>#-------------------------------</span>
<a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a><span class=c1>## To be filled in if Schema is enabled</span>
<a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a>apicurio.registry.url<span class=w> </span><span class=o>=</span><span class=w> </span>https://es-demo-ibm-es-ac-reg-external-cp4i-eventstreams.apps.cody.coc-ibm.com
<a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a><span class=c1># To be set to true if schema is not created up front.</span>
<a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a>auto.register.schemas<span class=o>=</span><span class=nb>false</span>
<a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a><span class=c1>## To be filled in if Schema Registry requires Authentication.</span>
<a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a>basic.auth.credentials.source<span class=w> </span><span class=o>=</span><span class=w> </span>USER_INFO
<a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a>schema.registry.basic.auth.user<span class=w> </span><span class=o>=</span><span class=w> </span>cody200-sr-user
<a id=__codelineno-3-40 name=__codelineno-3-40 href=#__codelineno-3-40></a>schema.registry.basic.auth.password<span class=w> </span><span class=o>=</span><span class=w> </span>EelwRR1
<a id=__codelineno-3-41 name=__codelineno-3-41 href=#__codelineno-3-41></a><span class=c1>#--------------------------------</span>
<a id=__codelineno-3-42 name=__codelineno-3-42 href=#__codelineno-3-42></a><span class=c1>## To be filled in if TLS is enabled for Schema Registry</span>
<a id=__codelineno-3-43 name=__codelineno-3-43 href=#__codelineno-3-43></a>schema.registry.ssl.truststore.type<span class=o>=</span>PKCS12
<a id=__codelineno-3-44 name=__codelineno-3-44 href=#__codelineno-3-44></a>schema.registry.ssl.truststore.location<span class=o>=</span>./es-cert.p12
<a id=__codelineno-3-45 name=__codelineno-3-45 href=#__codelineno-3-45></a>schema.registry.ssl.truststore.password<span class=o>=</span>luNbNsf
<a id=__codelineno-3-46 name=__codelineno-3-46 href=#__codelineno-3-46></a><span class=c1>#--------------------------------</span>
<a id=__codelineno-3-47 name=__codelineno-3-47 href=#__codelineno-3-47></a><span class=c1>## To be filled if Consumer / Producer Intercept should be turned on</span>
<a id=__codelineno-3-48 name=__codelineno-3-48 href=#__codelineno-3-48></a><span class=nv>intercept_bootstrapServers</span><span class=w> </span><span class=o>=</span><span class=w> </span>es3minimal-kafka-bootstrap-es3.mycluster-rajan07-992844b4e64c83c3dbd5e7b5e2da5328-0000.jp-tok.containers.appdomain.cloud:443
<a id=__codelineno-3-49 name=__codelineno-3-49 href=#__codelineno-3-49></a><span class=nv>intercept_sasljaas</span><span class=w> </span><span class=o>=</span><span class=w> </span>org.apache.kafka.common.security.scram.ScramLoginModule<span class=w> </span>required<span class=w> </span><span class=nv>username</span><span class=o>=</span><span class=s1>&#39;rajan&#39;</span><span class=w> </span><span class=nv>password</span><span class=o>=</span><span class=s1>&#39;CfKQZG9Cm7g5&#39;</span><span class=p>;</span>
<a id=__codelineno-3-50 name=__codelineno-3-50 href=#__codelineno-3-50></a><span class=nv>intercept_security</span><span class=w> </span><span class=o>=</span><span class=w> </span>SASL_SSL
<a id=__codelineno-3-51 name=__codelineno-3-51 href=#__codelineno-3-51></a><span class=nv>intercept_saslmechanism</span><span class=w> </span><span class=o>=</span><span class=w> </span>SCRAM-SHA-512
<a id=__codelineno-3-52 name=__codelineno-3-52 href=#__codelineno-3-52></a><span class=c1>#--------------------------------</span>
<a id=__codelineno-3-53 name=__codelineno-3-53 href=#__codelineno-3-53></a><span class=c1>## To be used when Kerberos Authentication is used</span>
<a id=__codelineno-3-54 name=__codelineno-3-54 href=#__codelineno-3-54></a>sasl.kerberos.service.name<span class=o>=</span>kafka
<a id=__codelineno-3-55 name=__codelineno-3-55 href=#__codelineno-3-55></a><span class=c1>#--------------------------------</span>
<a id=__codelineno-3-56 name=__codelineno-3-56 href=#__codelineno-3-56></a><span class=c1>## Other Optional parameters.</span>
<a id=__codelineno-3-57 name=__codelineno-3-57 href=#__codelineno-3-57></a><span class=nv>retries</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>2</span>
</code></pre></div> </li> <li> <p>Test producing message. </p> <p>Go to this folder in command prompt:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nb>cd</span><span class=w> </span>C:<span class=se>\T</span>echJam<span class=se>\E</span>ventStreams_Lab<span class=se>\K</span>afkaClient_YYYYMMDD<span class=se>\ </span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>java<span class=w> </span>-jar<span class=w> </span>KafkaClient.jar<span class=w> </span>producer<span class=w> </span><span class=m>10</span><span class=w> </span>config.properties
</code></pre></div> <p>Check if the message is listed in the topic. In the Event Streams portal, go to Topics. Look for the topic that you created. Click on it. Then click on messages. You should see the messages produced. </p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The messages content may not be displayed correctly in the portal due to binary serialization with Avro.</p> </div> <p><img alt src=../images/lab-2-sc-13.png width=1200></p> </li> <li> <p>Test consuming message. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>java<span class=w> </span>-jar<span class=w> </span>KafkaClient.jar<span class=w> </span>consumer<span class=w> </span>config.properties
</code></pre></div> <p>Messages should be consumed correctly. Message content should be displayed correctly. Press CTRL-C to stop the consumer. </p> <p><img alt src=../images/lab-2-sc-14.png width=1200></p> </li> </ol> <h2 id=check-the-impact-of-changing-the-schema-registry>Check the impact of changing the Schema Registry<a class=headerlink href=#check-the-impact-of-changing-the-schema-registry title="Permanent link">&para;</a></h2> <ol> <li> <p>We will change the schema registry by adding a new field with default value, and check what happens when producing / consuming. </p> <p>In the client computer, make a copy of the customer.avsc file (located in <code>C:\TechJam\EventStreams_Lab\KafkaClient_YYYYMMDD\&gt;</code>) and name it <code>customer_v2.avsc</code>. You can do this from Windows Explorer.</p> <p>Edit the file using Notepad++. Add this line right after country. Change the version to version <code>1.1</code>.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=w>   </span><span class=p>{</span><span class=w> </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;company&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;string&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;doc&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Customer Company&quot;</span><span class=p>},</span>
</code></pre></div> <p>The <code>customer_v2.avsc</code> should look like this:</p> <p><img alt src=../images/lab-2-sc-15.png width=1000></p> <p><img alt src=../images/lab-2-sc-16.png width=1200></p> </li> <li> <p>From the Event Streams portal, Go to Schema Registry -&gt; Click on your Schema. Then, click on “Add New Version”.</p> </li> <li> <p>Click on “Upload Definition” and select the edited avsc file (<code>customer_v2.avsc</code>).</p> <p><img alt src=../images/lab-2-sc-17.png width=1200></p> <p>You should get a validation failed message. </p> </li> <li> <p>Understanding Schema Registry Evolution</p> <p>When a schema is created, it has to have a compatibility mode. The most used compatibility modes are:</p> <ul> <li>BACKWARD - new schema can be used to read data written with old schema [e.g. consumer uses the new schema and read an older offset data]</li> <li>FORWARD - old schema can still be used (e.g. by consumers) to read data written in new schema</li> <li>FULL - Both forward and backward</li> </ul> <p>In Event Streams, the default compatibility mode is FULL. </p> <p>In our <code>customer_v2.avsc</code> we have added a new mandatory field. Older consumers may not be aware of this field until they update their code. Hence, our schema is NOT FORWARD compatible and so, it fails validation. </p> </li> <li> <p>Now, edit the schema file (customer_v2.avsc) again and add a default value to the newly added line. The line should look like this:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=p>{</span><span class=w> </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;company&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;string&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;default&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;IBM&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;doc&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Customer Company&quot;</span><span class=w> </span><span class=p>},</span>
</code></pre></div> <p>The <code>customer_v2.avsc</code> should look like this.</p> <p><img alt src=../images/lab-2-sc-18.png></p> </li> <li> <p>Now try updating the schema. Validation should pass. Change the version number and click on “Add Schema”. </p> </li> <li> <p>Test producing / consuming data</p> </li> <li> <p>Getting details about the schema. </p> <p>The Event Streams schema registry supports a Rest Endpoint that provides details about the schema. </p> <p>First make sure you have the Basic Authentication Token created during the process of creating the Kafka SCRAM User. If you missed copying the token, you can generate the token from the SCRAM USERNAME and SCRAM PASSWORD. </p> <p>Open this URL: <a href=https://www.base64encode.org/ >https://www.base64encode.org/</a> Enter your SCRAM USERNAME and SCRAM PASSWORD separated by a colon. E.g. <scram_user>:<scram_passeord> Click on Encode and it will generate the Basic Authentication Token. </p> </li> </ol> <p>Get the default compatibility. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>curl<span class=w> </span>-ki<span class=w> </span>-X<span class=w> </span>GET<span class=w> </span>-H<span class=w> </span><span class=s2>&quot;Accept: application/json&quot;</span><span class=w> </span>-H<span class=w> </span><span class=s2>&quot;Authorization: Basic &lt;BASIC AUTH TOKEN&gt;&quot;</span><span class=w> </span>https://&lt;SCHEMA_REGISTRY_URL&gt;/rules/COMPATIBILITY
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>E.g.<span class=w> </span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>curl<span class=w> </span>-ki<span class=w> </span>-X<span class=w> </span>GET<span class=w> </span>-H<span class=w> </span><span class=s2>&quot;Accept: application/json&quot;</span><span class=w> </span>-H<span class=w> </span><span class=s2>&quot;Authorization: Basic &lt;BASIC_AUTH_TOKEN&gt;&quot;</span><span class=w> </span>https://es1-ibm-es-ac-reg-external-cp4i.apps.ocp46.tec.uk.ibm.com/rules/COMPATIBILITY
</code></pre></div> <p>The response should be something like:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=p>{</span><span class=nt>&quot;config&quot;</span><span class=p>:</span><span class=s2>&quot;FULL&quot;</span><span class=p>,</span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=s2>&quot;COMPATIBILITY&quot;</span><span class=p>}</span>
</code></pre></div> <p>This shows that the default compatibility is FULL.</p> <p>Next get the compatibility of the specific schema that we are using. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>curl<span class=w> </span>-ki<span class=w> </span>-X<span class=w> </span>GET<span class=w> </span>-H<span class=w> </span><span class=s2>&quot;Accept: application/json&quot;</span><span class=w> </span>-H<span class=w> </span><span class=s2>&quot;Authorization: Basic &lt;BASIC_AUTH_TOKEN&gt;&quot;</span><span class=w> </span>https://es1-ibm-es-ac-reg-external-cp4i.apps.ocp46.tec.uk.ibm.com/artifacts/&lt;YOUR_SCHEMA_NAME&gt;/rules
</code></pre></div> <p>This should give you an empty response </p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=p>[]</span>
</code></pre></div> <p>Which basically means – the schema uses the default global setting – which is FULL (as we saw when we tried changing the schema).</p> <ul> <li>Test sending some message, you will see default value for the company new field.</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>java<span class=w> </span>-jar<span class=w> </span>KafkaClient.jar<span class=w> </span>producer<span class=w> </span><span class=m>10</span><span class=w> </span>config.properties
</code></pre></div> <p>!!! success "Congratulations!" You've completed the schema registry lab. </p> <p><a href=../eepm/ >&gt;&gt; Next - Event End Point Management</a></p> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.tabs", "navigation.instant", "navigation.sections", "navigation.expand", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.51d95adb.min.js></script> </body> </html>