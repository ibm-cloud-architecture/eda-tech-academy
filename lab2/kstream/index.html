<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Jerome Boyer"><link href=../../lab1/lab1-sol/ rel=prev><link href=../ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.6"><title>Kafka Streams Study - EDA technical academy</title><link rel=stylesheet href=../../assets/stylesheets/main.558e4712.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#kafka-stream-concepts class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="EDA technical academy" class="md-header__button md-logo" aria-label="EDA technical academy" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> EDA technical academy </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Kafka Streams Study </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ibm-cloud-architecture/eda-tech-academy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Introduction </a> </li> <li class=md-tabs__item> <a href=../../eda/ class=md-tabs__link> Information </a> </li> <li class=md-tabs__item> <a href=../../getting-started/ class=md-tabs__link> Journey 1 </a> </li> <li class=md-tabs__item> <a href=../../lab1/ class="md-tabs__link md-tabs__link--active"> Journey 2 </a> </li> <li class=md-tabs__item> <a href=../../future/ class=md-tabs__link> More... </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="EDA technical academy" class="md-nav__button md-logo" aria-label="EDA technical academy" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> EDA technical academy </label> <div class=md-nav__source> <a href=https://github.com/ibm-cloud-architecture/eda-tech-academy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 tabindex=0 aria-expanded=false> Information <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Information data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Information </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../eda/ class=md-nav__link> Why EDA now? </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/refarch-eda/concepts/fit-to-purpose/ class=md-nav__link> Fit for purpose </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/refarch-eda/introduction/reference-architecture/#event-driven-architecture class=md-nav__link> EDA Reference Architecture </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 tabindex=0 aria-expanded=false> Journey 1 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Journey 1" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Journey 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/ class=md-nav__link> Getting started with Event Streams </a> </li> <li class=md-nav__item> <a href=../../getting-started/schema-lab/ class=md-nav__link> Event Streams schema </a> </li> <li class=md-nav__item> <a href=../../getting-started/eepm/ class=md-nav__link> Event-endpoint management </a> </li> <li class=md-nav__item> <a href=../../getting-started/mm2/ class=md-nav__link> Mirror maker 2 lab </a> </li> <li class=md-nav__item> <a href=../../demo/ class=md-nav__link> Demonstration A to Z </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 tabindex=0 aria-expanded=true> Journey 2 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Journey 2" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Journey 2 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4_1 type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 tabindex=0 aria-expanded=false> Lab 1 - System Design Lab <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Lab 1 - System Design Lab" data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Lab 1 - System Design Lab </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../lab1/ class=md-nav__link> Problem Statement </a> </li> <li class=md-nav__item> <a href=../../lab1/lab1-sol/ class=md-nav__link> Solution Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2 checked> <label class=md-nav__link for=__nav_4_2 tabindex=0 aria-expanded=true> Kafka Streams Lab <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kafka Streams Lab" data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Kafka Streams Lab </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Kafka Streams Study <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Kafka Streams Study </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#kafka-stream-concepts class=md-nav__link> Kafka Stream concepts </a> <nav class=md-nav aria-label="Kafka Stream concepts"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#topology class=md-nav__link> Topology </a> </li> <li class=md-nav__item> <a href=#kstream-api class=md-nav__link> KStream API </a> </li> <li class=md-nav__item> <a href=#ktable class=md-nav__link> KTable </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ class=md-nav__link> Lab 2 exercises </a> </li> <li class=md-nav__item> <a href=../lab2-sol/ class=md-nav__link> Solution Overview </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../lab3/ class=md-nav__link> Lab 3 - Real Time Inventory demo </a> </li> <li class=md-nav__item> <a href=../../lab4/ class=md-nav__link> Lab 4 - EDA GitOps </a> </li> <li class=md-nav__item> <a href=../../lab5/ class=md-nav__link> Lab 5 - Monitoring with Instana </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../future/ class=md-nav__link> More... </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#kafka-stream-concepts class=md-nav__link> Kafka Stream concepts </a> <nav class=md-nav aria-label="Kafka Stream concepts"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#topology class=md-nav__link> Topology </a> </li> <li class=md-nav__item> <a href=#kstream-api class=md-nav__link> KStream API </a> </li> <li class=md-nav__item> <a href=#ktable class=md-nav__link> KTable </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Kafka Streams Study</h1> <p>You need to understand some basic on how to use the <a href=https://kafka.apache.org/20/documentation/streams/developer-guide/ >Kafka Stream APIs</a> so you can develop some simple streaming applications in a scope of a proof of concept.</p> <h2 id=kafka-stream-concepts>Kafka Stream concepts<a class=headerlink href=#kafka-stream-concepts title="Permanent link">&para;</a></h2> <p>Any Java or Scala application can use Kafka Streams APIs.</p> <h3 id=topology>Topology<a class=headerlink href=#topology title="Permanent link">&para;</a></h3> <p>The business logic is implemented via a Kafka Streams "topology" which represents a graph of processing operators or nodes. Each node within the graph, processes events from the parent node and may generate events for the down stream node(s). This is really close to the Java Streaming APIs or Mutiny APIs, but the APIs used by the topology is from Kafka Streams APIS.</p> <p>Kafka Streams applications are built on top of Kafka producer and consumer APIs and are leveraging Kafka capabilities to do data parallelism processing, to support distributed coordination of partition to task assignment, and to support fault tolerance. In Java the streaming topology will be executed in multiple threads and explicitly started in the Java app.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=w>  </span><span class=n>Properties</span><span class=w> </span><span class=n>props</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>buildKafkaProperties</span><span class=p>();</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>  </span><span class=n>kafkaStreams</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>KafkaStreams</span><span class=p>(</span><span class=n>buildProcessFlow</span><span class=p>(),</span><span class=w> </span><span class=n>props</span><span class=p>);</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>  </span><span class=n>kafkaStreams</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</code></pre></div> <p>To build a topology we use a StreamsBuilder class to define the input streams (mapped to a Kakfa topic), the logic to apply to the events and then how to produce results to a Kafka topic.</p> <div class=highlight><span class=filename>Define a topology</span><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>// Create a builder</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=kd>final</span><span class=w> </span><span class=n>StreamsBuilder</span><span class=w> </span><span class=n>builder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StreamsBuilder</span><span class=p>();</span><span class=w> </span><span class=c1>// (1)</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=c1>// define the KStream abstraction by defining where the data come from (topic) and in which format</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=n>KStream</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=n>ItemTransaction</span><span class=o>&gt;</span><span class=w> </span><span class=n>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>builder</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>itemSoldInputStreamName</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>        </span><span class=n>Consumed</span><span class=p>.</span><span class=na>with</span><span class=p>(</span><span class=n>Serdes</span><span class=p>.</span><span class=na>String</span><span class=p>(),</span><span class=w>  </span><span class=n>StoreSerdes</span><span class=p>.</span><span class=na>ItemTransactionSerde</span><span class=p>()));</span><span class=w>  </span><span class=c1>// (2)</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=kd>final</span><span class=w> </span><span class=n>Topology</span><span class=w> </span><span class=n>topology</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>builder</span><span class=p>.</span><span class=na>build</span><span class=p>();</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=c1>// start the topology in a thread... we will this code later</span>
</code></pre></div> <ol> <li>StreamsBuilder to build a topology and run it</li> <li>Define a stream from a topic with serialization of the value to a Java Bean</li> </ol> <p>The following figure illustrates the topology concept:</p> <p><img alt src=../images/topology.jpg></p> <p>So let start by learning more about KStream construct.</p> <details class=-> <summary>More Reading</summary> <ul> <li>If you do not know about topic, kafka producer, and consumer, you may spend time to read some quick <a href=https://ibm.github.io/event-streams/about/key-concepts/ >kafka concepts</a></li> <li>More <a href=https://ibm.github.io/event-streams/about/producing-messages/ >about producer practice</a></li> <li>And <a href=https://ibm.github.io/event-streams/about/consuming-messages/ >consumer</a></li> <li>More <a href=https://ibm-cloud-architecture.github.io/refarch-eda/technology/kafka-producers/ >advanced practices for producer</a> and <a href=https://ibm-cloud-architecture.github.io/refarch-eda/technology/kafka-consumers/ >consumer</a></li> </ul> </details> <h3 id=kstream-api>KStream API<a class=headerlink href=#kstream-api title="Permanent link">&para;</a></h3> <p><a href=https://kafka.apache.org/30/javadoc/org/apache/kafka/streams/kstream/KStream.html>KStream</a> is an abstraction of a Kafka record stream. It can be defined from one ot multiple Topics, and will define the structure of the Kafka record key, and the record structure.</p> <p>The following declaration is for consuming from topic named <code>items</code> with Key and Value of type <code>String</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=w> </span><span class=n>KStream</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>aStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>builder</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=s>&quot;items&quot;</span><span class=p>,</span><span class=n>Consumed</span><span class=p>.</span><span class=na>with</span><span class=p>(</span><span class=n>Serdes</span><span class=p>.</span><span class=na>String</span><span class=p>(),</span><span class=w> </span><span class=n>Serdes</span><span class=p>.</span><span class=na>String</span><span class=p>()));</span>
</code></pre></div> <p>Then Kstream offers a lot of functions to process the records. Below is a quick summary of the methods you may need to use in the next exercises:</p> <table> <thead> <tr> <th>Method</th> <th>What it does</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td><strong>peek</strong></td> <td>Perform an action on each record of KStream.</td> <td>aStream.peek((key, value) -&gt; System.out.println(value)</td> </tr> <tr> <td><strong>to</strong></td> <td>transform the stream to a topic</td> <td>aStream.to(outTopicName)</td> </tr> <tr> <td><strong>filter</strong></td> <td>Create a new KStream with records which satisfy the given predicate.</td> <td>.filter((key, value) -&gt; ("BLUE".equalsIgnoreCase(value)))</td> </tr> <tr> <td><strong>split</strong></td> <td>Split this stream into different branches.</td> <td>aStream.split().branch((key, value) -&gt; value.userId == null, Branched.as("no-userid")).defaultBranch(Branched.as("non-null"));</td> </tr> <tr> <td><strong>groupBy</strong></td> <td>Group the records of this KStream on current key</td> <td></td> </tr> <tr> <td><strong>groupByKey</strong></td> <td>Group the records of this KStream on a new key</td> <td></td> </tr> <tr> <td><strong><a href=https://kafka.apache.org/30/javadoc/org/apache/kafka/streams/kstream/KGroupedStream.html>KGroupedStream</a></strong></td> <td>Intermediate representation of a KStream in order to apply an aggregation operation</td> <td>Ouput of groupByKey</td> </tr> <tr> <td><a href=https://kafka.apache.org/30/javadoc/org/apache/kafka/streams/kstream/KGroupedStream.html#aggregate>aggregate</a></td> <td>Aggregate the values of records in this stream by the grouped key</td> <td>.aggregate(() -&gt; new StoreInventory(), (store , newItem, existingStoreInventory) -&gt; existingStoreInventory.updateStockQuantity(store,newItem), materializeAsStoreInventoryKafkaStore());</td> </tr> <tr> <td><a href=https://kafka.apache.org/30/javadoc/org/apache/kafka/streams/kstream/KStream.html#split()>split</a></td> <td>Split a stream into branches</td> <td>items.split(Named.as("B-"))</td> </tr> <tr> <td><a href=https://kafka.apache.org/30/javadoc/org/apache/kafka/streams/kstream/BranchedKStream.html>BranchedKStream</a></td> <td>Branches the records in the original stream based on the predicates supplied for the branch definitions.</td> <td>.branch((k,v) -&gt; (v.storeName == null), Branched.as("wrong-tx")).defaultBranch(Branched.as("good-tx")); branches.get("B-good-tx").to(outTopicName); branches.get("B-wrong-tx").to(deadLetterTopicName);</td> </tr> <tr> <td><a href=https://kafka.apache.org/32/javadoc/org/apache/kafka/streams/kstream/KStream.html#selectKey(org.apache.kafka.streams.kstream.KeyValueMapper)>selectKey</a></td> <td>Change the key of a record</td> <td></td> </tr> </tbody> </table> <h3 id=ktable>KTable<a class=headerlink href=#ktable title="Permanent link">&para;</a></h3> <p><a href=https://kafka.apache.org/30/javadoc/org/apache/kafka/streams/kstream/KTable.html>KTable</a> is the second main abstraction of a changelog stream from a primary-keyed table. Each record in this changelog stream is an update on the primary-keyed table with the record key as the primary key.</p> <p>A stream can be considered a changelog of a table, where each data record in the stream captures a state change of the table.</p> <p>The figure below is a simplication of both concepts:</p> <p><img alt src=../images/stream-table.png></p> <p>A <strong>Kstream</strong> is first connect to a topic and will receive events with Key,Value structure, as unbounded stream. You can chain Kstream to build a topology, and to a Ktable, which will keep only the last value of a given key. To ouput to a Kafka topic, the final construct is a KStream.</p> <p>KStreams are in memory, Ktables are also in memory but may be persisted. KTable assumes that records from the source topic that have null keys are simply dropped.</p> <p>KTable can be created directly from a Kafka topic (using StreamsBuilder.table operator), as a result of transformations on an existing KTable, or aggregations (aggregate, count, and reduce). </p> <p>Stateful transformations depend on state for processing inputs and producing outputs and require a state store associated with the stream processor. For example, in aggregating operations, a windowing state store is used to collect the latest aggregation results per window.</p> <p>KTables need to additionally maintain their respective state in between events so that operations like aggregations (e.g., COUNT()) can work properly. </p> <p>Every ktable has its own state store. Any operation on the table such as querying, inserting, or updating a row is carried out behind the scenes by a corresponding operation on the table’s state store.</p> <p>These state stores are being materialized on local disk inside your application instances. </p> <p>Kafka Streams uses <a href=https://github.com/facebook/rocksdb/wiki>RocksDB</a> as the default storage engine for persistent state stores. RockDB is a fast key-value server, especially suited for storing data on flash drives.</p> <p>The following figure summarizes all those concepts:</p> <p><img alt src=../images/ktable-rockdb.png></p> <p>There are as many caches as there are threads, but no sharing of caches across threads happens. Records are evicted using a simple LRU scheme after the cache size is reached. The semantics of caching is that data is flushed to the state store and forwarded to the next downstream processor node whenever the earliest of <code>commit.interval.ms</code> or <code>cache.max.bytes.buffering</code> (cache pressure) hits. As illustrated in the example <a href>TestAccumulateItemSoldWithCaching</a> when using cache, records are output at the end of the commit interval or when reaching max buffer size.</p> <p>Interesting methods:</p> <table> <thead> <tr> <th>Method</th> <th>What it does</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td><strong>filter</strong></td> <td>Create a new KTable that consists of all records of this KTable which satisfy the given predicate</td> <td></td> </tr> <tr> <td><strong>join</strong></td> <td>join streams with tables or table to table</td> <td></td> </tr> </tbody> </table> <details class=-> <summary>Read more</summary> <ul> <li><a href=https://kafka.apache.org/31/documentation/streams/tutorial>Apache Kafka - TUTORIAL: WRITE A KAFKA STREAMS APPLICATION</a></li> <li><a href=https://kafka.apache.org/30/javadoc/org/apache/kafka/streams/kstream/KStream.html>KStream API</a></li> <li><a href=https://kafka.apache.org/30/javadoc/org/apache/kafka/streams/kstream/KTable.html>Ktable API</a></li> <li><a href=https://ibm-cloud-architecture.github.io/refarch-eda/technology/kafka-streams/ >Kafka Streams summary</a></li> <li><a href=https://ibm-cloud-architecture.github.io/refarch-eda/use-cases/kafka-streams/ >Other labs</a></li> </ul> </details> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.tabs", "navigation.instant", "navigation.sections", "navigation.expand", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.51d95adb.min.js></script> </body> </html>